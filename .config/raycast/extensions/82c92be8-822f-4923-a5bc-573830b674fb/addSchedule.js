"use strict";var R=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var Q=(t,e)=>{for(var n in e)R(t,n,{get:e[n],enumerable:!0})},X=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of z(e))!G.call(t,r)&&r!==n&&R(t,r,{get:()=>e[r],enumerable:!(s=q(e,r))||s.enumerable});return t};var Z=t=>X(R({},"__esModule",{value:!0}),t);var te={};Q(te,{default:()=>j});module.exports=Z(te);var x=require("react"),a=require("@raycast/api");var N=require("@raycast/api"),D=require("react"),O={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6};function F(t,e){let n=(0,D.useRef)(t),s=(0,D.useRef)(e);(0,D.useEffect)(()=>{n.current=t,s.current=e}),(0,D.useEffect)(()=>{let r=!0;async function u(){s.current(!0);let f=await N.LocalStorage.allItems();if(!r)return;let l=Object.values(f).map(h=>JSON.parse(h));l.length>0&&(l.sort((h,g)=>(O[h.day]??-1)-(O[g.day]??-1)),n.current(l)),s.current(!1)}return u(),()=>{r=!1}},[])}var c=require("@raycast/api"),w=require("react/jsx-runtime");function U({searchText:t,schedule:e,onSetScheduleAction:n,onDeleteScheduleAction:s,onPauseScheduleAction:r,onResumeScheduleAction:u}){return(0,w.jsxs)(c.ActionPanel,{children:[t.length>0&&(0,w.jsx)(c.Action,{title:"Set Schedule",icon:c.Icon.Calendar,onAction:n}),(0,w.jsx)(c.Action,{title:"Set Caffeination Schedule",icon:c.Icon.CopyClipboard,shortcut:{modifiers:["cmd"],key:"s"},onAction:()=>n()}),(0,w.jsx)(c.Action,{title:"Delete Caffeination Schedule",style:c.Action.Style.Destructive,icon:c.Icon.Trash,shortcut:c.Keyboard.Shortcut.Common.Remove,onAction:()=>s(e)}),e.IsManuallyDecafed?(0,w.jsx)(c.Action,{title:"Resume Caffeination Schedule",icon:c.Icon.Play,onAction:()=>u(e)}):(0,w.jsx)(c.Action,{title:"Pause Caffeination Schedule",icon:c.Icon.Pause,onAction:()=>r(e)})]})}var d=require("@raycast/api"),A=require("node:child_process");async function H(t,e,n){e&&await(0,d.showHUD)(e),await C({menubar:!1,status:!1});let s=_(n).split(/\s+/).filter(Boolean);(0,A.spawn)("/usr/bin/caffeinate",s,{detached:!0,stdio:"ignore"}).unref(),await J(t,!0)}async function C(t,e){e&&await(0,d.showHUD)(e),(0,A.execSync)("/usr/bin/killall caffeinate || true"),await J(t,!1)}async function J(t,e){t.menubar&&await $("index",{caffeinated:e}),t.status&&await $("status",{caffeinated:e})}async function $(t,e){try{await(0,d.launchCommand)({name:t,type:d.LaunchType.Background,context:e})}catch{}}function _(t){let e=(0,d.getPreferenceValues)(),n=[];e.preventDisplay&&n.push("d"),e.preventDisk&&n.push("m"),e.preventSystem&&n.push("i");let s=[];return n.length>0&&s.push(`-${n.join("")}`),t&&s.push(t),s.join(" ")}function I(t){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t]}async function W(){let e=I(new Date().getDay()).toLowerCase(),n=await d.LocalStorage.getItem(e);return n===void 0?void 0:JSON.parse(n)}async function T(t,e){switch(t){case"caffeinate":{e.IsManuallyDecafed=!1,e.IsRunning=!1,await d.LocalStorage.setItem(e.day,JSON.stringify(e));break}case"decaffeinate":{(e.IsRunning===!0||v(e))&&(e.IsManuallyDecafed=!0,e.IsRunning=!1,await d.LocalStorage.setItem(e.day,JSON.stringify(e)));break}default:break}}function L(t){let n=I(new Date().getDay()).toLowerCase();return t.day===n}function v(t){let n=I(new Date().getDay()).toLowerCase();return t.day!==n}var b=require("@raycast/api");async function E(t){let e=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],n=t.toLowerCase(),s=/(\d{2}:\d{2})/g,r=n.match(s);if(!r||r.length<2)return await(0,b.showToast)(b.Toast.Style.Failure,"Oops! Please specify both 'from' and 'to' times in HH:MM format."),null;let[u,f]=r,l=e.filter(g=>n.includes(g));return n.includes("except")?l.length===0?(await(0,b.showToast)(b.Toast.Style.Failure,"Oops! Please mention the days to be excluded."),null):{days:e.filter(i=>!l.includes(i)),from:u,to:f}:{days:l.length>0?l:e,from:u,to:f}}var P=require("@raycast/api");async function ee(t){if(!t||Object.keys(t).length===0)return!1;let e=new Date,[n,s]=t.from.split(":").map(Number),[r,u]=t.to.split(":").map(Number),f=e.getHours(),l=e.getMinutes(),h=(f>n||f===n&&l>=s)&&(f<r||f===r&&l<u);if(h===!1&&t.IsRunning===!0)return t.IsRunning=!1,await C({menubar:!0,status:!0}),await P.LocalStorage.setItem(t.day,JSON.stringify(t)),!1;if(h===!0&&t.IsRunning===!1){let g=(r-n)*3600+(u-s)*60;return await H({menubar:!0,status:!0},void 0,`-t ${g}`),t.IsRunning=!0,await P.LocalStorage.setItem(t.day,JSON.stringify(t)),!0}return!1}async function M(){let t=await W();return t===void 0||t.IsManuallyDecafed?!1:await ee(t)}var S=require("react/jsx-runtime");function j(){let[t,e]=(0,x.useState)(""),[n,s]=(0,x.useState)(!0),[r,u]=(0,x.useState)([]);F(u,s);let f=async()=>{try{let i=await E(t);if(!i)return;let{days:y,from:o,to:p}=i,k=y.map(m=>({day:m,from:o,to:p,IsManuallyDecafed:!1,IsRunning:!1}));for(let m of k)await a.LocalStorage.setItem(m.day,JSON.stringify(m));let B=I(new Date().getDay()).toLowerCase(),V=await M(),K=k.map(m=>B===m.day?{...m,IsRunning:V}:m);u(m=>[...m.filter(Y=>!y.includes(Y.day)),...K]),await(0,a.showToast)(a.Toast.Style.Success,"Caffeination schedule set successfully."),e("")}catch(i){console.error("Failed to set schedule:",i),await(0,a.showToast)(a.Toast.Style.Failure,"Failed to set schedule.")}},l=async i=>{if(await(0,a.confirmAlert)({title:"Delete schedule",message:"Are you sure you wish to delete this schedule?",primaryAction:{title:"Yes",style:a.Alert.ActionStyle.Destructive},dismissAction:{title:"No",style:a.Alert.ActionStyle.Cancel},icon:{source:a.Icon.Trash,tintColor:a.Color.Red}}))try{i.IsRunning===!0&&await C({menubar:!0,status:!0}),await a.LocalStorage.removeItem(i.day),await(0,a.showToast)(a.Toast.Style.Success,"Schedule deleted.");let o=r.filter(p=>p.day!==i.day);u(o)}catch(o){console.error("Failed to delete schedule:",o),await(0,a.showToast)(a.Toast.Style.Failure,"Failed to delete schedule.")}},h=async i=>{T("decaffeinate",i),await(0,a.showToast)(a.Toast.Style.Success,`Schedule for ${i.day.charAt(0).toUpperCase()+i.day.slice(1).toLowerCase()} is now paused`),L(i)&&await C({menubar:!0,status:!0}),u(y=>y.map(o=>o.day===i.day?{...o,IsRunning:!1,IsManuallyDecafed:!0}:o))},g=async i=>{T("caffeinate",i),await(0,a.showToast)(a.Toast.Style.Success,`Schedule for ${i.day.charAt(0).toUpperCase()+i.day.slice(1).toLowerCase()} is now resumed`);let y=await M();u(o=>o.map(p=>p.day===i.day?{...p,IsRunning:y,IsManuallyDecafed:!1}:p))};return(0,S.jsx)(a.List,{searchText:t,isLoading:n,searchBarPlaceholder:"Schedule for Monday and Tuesday from 12:00 to 14:00",onSearchTextChange:e,filtering:!1,actions:(0,S.jsx)(a.ActionPanel,{children:(0,S.jsx)(a.Action,{autoFocus:!0,title:"Set Schedule",icon:a.Icon.Calendar,onAction:f})}),children:r.length===0?(0,S.jsx)(a.List.EmptyView,{title:"No caffeination schedules yet",description:"To schedule, enter the days to be scheduled and time range, then hit enter!",icon:a.Icon.Calendar}):(0,S.jsx)(S.Fragment,{children:["Today's Schedule","Caffeination Schedule"].map((i,y)=>(0,S.jsx)(a.List.Section,{title:i,children:r.filter(y===0?L:v).map((o,p)=>(0,S.jsx)(a.List.Item,{title:o.day.charAt(0).toUpperCase()+o.day.slice(1),accessories:[{text:y===0?o.IsRunning?"Running":o.IsManuallyDecafed?"Paused":"Scheduled":o.IsManuallyDecafed?"Scheduled Paused":"Scheduled",icon:y===0?o.IsRunning?a.Icon.Play:o.IsManuallyDecafed?a.Icon.Pause:a.Icon.Calendar:a.Icon.Calendar}],subtitle:`Set from ${o.from} to ${o.to}`,icon:a.Icon.Calendar,actions:(0,S.jsx)(U,{searchText:t,schedule:o,onSetScheduleAction:f,onDeleteScheduleAction:l,onPauseScheduleAction:()=>h(o),onResumeScheduleAction:()=>g(o)})},p))},y))})})}
