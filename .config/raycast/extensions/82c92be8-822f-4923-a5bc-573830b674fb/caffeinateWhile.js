"use strict";var Z=Object.create;var y=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var ee=(r,e)=>{for(var t in e)y(r,t,{get:e[t],enumerable:!0})},C=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Y(e))!Q.call(r,a)&&a!==t&&y(r,a,{get:()=>e[a],enumerable:!(n=q(e,a))||n.enumerable});return r};var v=(r,e,t)=>(t=r!=null?Z(X(r)):{},C(e||!r||!r.__esModule?y(t,"default",{value:r,enumerable:!0}):t,r)),te=r=>C(y({},"__esModule",{value:!0}),r);var de={};ee(de,{default:()=>F});module.exports=te(de);var d=require("@raycast/api");var h=v(require("react")),o=require("@raycast/api");var L=v(require("node:child_process")),M=require("node:buffer"),m=v(require("node:stream")),W=require("node:util");var z=require("react/jsx-runtime");var S=globalThis;var w=r=>!!r&&typeof r=="object"&&typeof r.removeListener=="function"&&typeof r.emit=="function"&&typeof r.reallyExit=="function"&&typeof r.listeners=="function"&&typeof r.kill=="function"&&typeof r.pid=="number"&&typeof r.on=="function",E=Symbol.for("signal-exit emitter"),R=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),S[E])return S[E];Object.defineProperty(S,E,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(e,t){this.listeners[e].push(t)}removeListener(e,t){let n=this.listeners[e],a=n.indexOf(t);a!==-1&&(a===0&&n.length===1?n.length=0:n.splice(a,1))}emit(e,t,n){if(this.emitted[e])return!1;this.emitted[e]=!0;let a=!1;for(let s of this.listeners[e])a=s(t,n)===!0||a;return e==="exit"&&(a=this.emit("afterExit",t,n)||a),a}},T=class{onExit(){return()=>{}}load(){}unload(){}},_=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(e){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new R,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=e,this.#a={};for(let t of this.#r)this.#a[t]=()=>{let n=this.#e.listeners(t),{count:a}=this.#t,s=e;if(typeof s.__signal_exit_emitter__=="object"&&typeof s.__signal_exit_emitter__.count=="number"&&(a+=s.__signal_exit_emitter__.count),n.length===a){this.unload();let i=this.#t.emit("exit",null,t),c=t==="SIGHUP"?this.#o:t;i||e.kill(e.pid,c)}};this.#i=e.reallyExit,this.#s=e.emit}onExit(e,t){if(!w(this.#e))return()=>{};this.#n===!1&&this.load();let n=t?.alwaysLast?"afterExit":"exit";return this.#t.on(n,e),()=>{this.#t.removeListener(n,e),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let e of this.#r)try{let t=this.#a[e];t&&this.#e.on(e,t)}catch{}this.#e.emit=(e,...t)=>this.#l(e,...t),this.#e.reallyExit=e=>this.#c(e)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(e=>{let t=this.#a[e];if(!t)throw new Error("Listener not defined for signal: "+e);try{this.#e.removeListener(e,t)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(e){return w(this.#e)?(this.#e.exitCode=e||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(e,...t){let n=this.#s;if(e==="exit"&&w(this.#e)){typeof t[0]=="number"&&(this.#e.exitCode=t[0]);let a=n.call(this.#e,e,...t);return this.#t.emit("exit",this.#e.exitCode,null),a}else return n.call(this.#e,e,...t)}},A=null,re=(r,e)=>(A||(A=w(process)?new _(process):new T),A.onExit(r,e));function ne(r,{timeout:e}={}){let t=new Promise((c,l)=>{r.on("exit",(u,p)=>{c({exitCode:u,signal:p,timedOut:!1})}),r.on("error",u=>{l(u)}),r.stdin&&r.stdin.on("error",u=>{l(u)})}),n=re(()=>{r.kill()});if(e===0||e===void 0)return t.finally(()=>n());let a,s=new Promise((c,l)=>{a=setTimeout(()=>{r.kill("SIGTERM"),l(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},e)}),i=t.finally(()=>{clearTimeout(a)});return Promise.race([s,i]).finally(()=>n())}var U=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function ae(r){let{encoding:e}=r,t=e==="buffer",n=new m.default.PassThrough({objectMode:!1});e&&e!=="buffer"&&n.setEncoding(e);let a=0,s=[];return n.on("data",i=>{s.push(i),a+=i.length}),n.getBufferedValue=()=>t?Buffer.concat(s,a):s.join(""),n.getBufferedLength=()=>a,n}async function I(r,e){let t=ae(e);return await new Promise((n,a)=>{let s=i=>{i&&t.getBufferedLength()<=M.constants.MAX_LENGTH&&(i.bufferedData=t.getBufferedValue()),a(i)};(async()=>{try{await(0,W.promisify)(m.default.pipeline)(r,t),n()}catch(i){s(i)}})(),t.on("data",()=>{t.getBufferedLength()>8e7&&s(new U)})}),t.getBufferedValue()}async function O(r,e){r.destroy();try{return await e}catch(t){return t.bufferedData}}async function se({stdout:r,stderr:e},{encoding:t},n){let a=I(r,{encoding:t}),s=I(e,{encoding:t});try{return await Promise.all([n,a,s])}catch(i){return Promise.all([{error:i,exitCode:null,signal:i.signal,timedOut:i.timedOut||!1},O(r,a),O(e,s)])}}function ie(r){let e=typeof r=="string"?`
`:10,t=typeof r=="string"?"\r":13;return r[r.length-1]===e&&(r=r.slice(0,-1)),r[r.length-1]===t&&(r=r.slice(0,-1)),r}function D(r,e){return r.stripFinalNewline?ie(e):e}function oe({timedOut:r,timeout:e,signal:t,exitCode:n}){return r?`timed out after ${e} milliseconds`:t!=null?`was killed with ${t}`:n!=null?`failed with exit code ${n}`:"failed"}function ce({stdout:r,stderr:e,error:t,signal:n,exitCode:a,command:s,timedOut:i,options:c,parentError:l}){let p=`Command ${oe({timedOut:i,timeout:c?.timeout,signal:n,exitCode:a})}: ${s}`,$=t?`${p}
${t.message}`:p,x=[$,e,r].filter(Boolean).join(`
`);return t?t.originalMessage=t.message:t=l,t.message=x,t.shortMessage=$,t.command=s,t.exitCode=a,t.signal=n,t.stdout=r,t.stderr=e,"bufferedData"in t&&delete t.bufferedData,t}function le({stdout:r,stderr:e,error:t,exitCode:n,signal:a,timedOut:s,command:i,options:c,parentError:l}){if(t||n!==0||a!==null)throw ce({error:t,exitCode:n,signal:a,stdout:r,stderr:e,command:i,timedOut:s,options:c,parentError:l});return r}async function P(r,e,t){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:n,language:a,timeout:s,...i}=Array.isArray(e)?t||{}:e||{},c=n!==!1?[]:["-ss"];a==="JavaScript"&&c.push("-l","JavaScript"),Array.isArray(e)&&c.push("-",...e);let l=L.default.spawn("osascript",c,{...i,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),u=ne(l,{timeout:s??1e4});l.stdin.end(r);let[{error:p,exitCode:$,signal:x,timedOut:B},G,K]=await se(l,{encoding:"utf8"},u),J=D({stripFinalNewline:!0},G),H=D({stripFinalNewline:!0},K);return le({stdout:J,stderr:H,error:p,exitCode:$,signal:x,timedOut:B,command:"osascript",options:t,parentError:new Error})}var g=require("react");var f=require("@raycast/api"),k=require("node:child_process");async function N(r,e,t){e&&await(0,f.showHUD)(e),await ue({menubar:!1,status:!1});let n=fe(t).split(/\s+/).filter(Boolean);(0,k.spawn)("/usr/bin/caffeinate",n,{detached:!0,stdio:"ignore"}).unref(),await j(r,!0)}async function ue(r,e){e&&await(0,f.showHUD)(e),(0,k.execSync)("/usr/bin/killall caffeinate || true"),await j(r,!1)}async function j(r,e){r.menubar&&await V("index",{caffeinated:e}),r.status&&await V("status",{caffeinated:e})}async function V(r,e){try{await(0,f.launchCommand)({name:r,type:f.LaunchType.Background,context:e})}catch{}}function fe(r){let e=(0,f.getPreferenceValues)(),t=[];e.preventDisplay&&t.push("d"),e.preventDisk&&t.push("m"),e.preventSystem&&t.push("i");let n=[];return t.length>0&&n.push(`-${t.join("")}`),r&&n.push(r),n.join(" ")}var b=require("react/jsx-runtime");function F(){let[r,e]=(0,g.useState)(!0),[t,n]=(0,g.useState)([]);return(0,g.useEffect)(()=>{let a=!0;return(async()=>{let s=(await P('tell application "System Events" to get the unix id of every process whose background only is false')).split(", "),i=(await P('tell application "System Events" to get the name of every process whose background only is false')).split(", ");if(!a)return;let c=i.map((l,u)=>({[l]:s[u]}));n(c),e(!1)})(),()=>{a=!1}},[]),(0,b.jsx)(d.Form,{isLoading:r,actions:(0,b.jsx)(d.ActionPanel,{children:(0,b.jsx)(d.Action.SubmitForm,{title:"Caffeinate",onSubmit:async a=>{await N({menubar:!0,status:!0},"Caffeinate process started",`-w ${a.process}`),(0,d.popToRoot)()}})}),children:(0,b.jsx)(d.Form.Dropdown,{id:"process",title:"Application",children:t.map(a=>{let s=Object.keys(a)[0];return(0,b.jsx)(d.Form.Dropdown.Item,{value:a[s],title:s},s)})})})}
