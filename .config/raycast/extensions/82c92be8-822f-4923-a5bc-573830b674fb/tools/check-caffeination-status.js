"use strict";var f=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var I=(e,t)=>{for(var n in t)f(e,n,{get:t[n],enumerable:!0})},k=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of C(t))!x.call(e,i)&&i!==n&&f(e,i,{get:()=>t[i],enumerable:!(a=D(t,i))||a.enumerable});return e};var v=e=>k(f({},"__esModule",{value:!0}),e);var L={};I(L,{default:()=>O});module.exports=v(L);var o=require("@raycast/api");var r=require("@raycast/api"),s=require("node:child_process");async function m(e,t,n){t&&await(0,r.showHUD)(t),await c({menubar:!1,status:!1});let a=M(n).split(/\s+/).filter(Boolean);(0,s.spawn)("/usr/bin/caffeinate",a,{detached:!0,stdio:"ignore"}).unref(),await S(e,!0)}async function c(e,t){t&&await(0,r.showHUD)(t),(0,s.execSync)("/usr/bin/killall caffeinate || true"),await S(e,!1)}async function S(e,t){e.menubar&&await g("index",{caffeinated:t}),e.status&&await g("status",{caffeinated:t})}async function g(e,t){try{await(0,r.launchCommand)({name:e,type:r.LaunchType.Background,context:t})}catch{}}function M(e){let t=(0,r.getPreferenceValues)(),n=[];t.preventDisplay&&n.push("d"),t.preventDisk&&n.push("m"),t.preventSystem&&n.push("i");let a=[];return n.length>0&&a.push(`-${n.join("")}`),e&&a.push(e),a.join(" ")}function l(){try{return(0,s.execSync)("pgrep caffeinate"),!0}catch{return!1}}function R(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]}async function h(){let t=R(new Date().getDay()).toLowerCase(),n=await r.LocalStorage.getItem(t);return n===void 0?void 0:JSON.parse(n)}async function N(e){if(!e||Object.keys(e).length===0)return!1;let t=new Date,[n,a]=e.from.split(":").map(Number),[i,d]=e.to.split(":").map(Number),u=t.getHours(),p=t.getMinutes(),y=(u>n||u===n&&p>=a)&&(u<i||u===i&&p<d);if(y===!1&&e.IsRunning===!0)return e.IsRunning=!1,await c({menubar:!0,status:!0}),await o.LocalStorage.setItem(e.day,JSON.stringify(e)),!1;if(y===!0&&e.IsRunning===!1){let b=(i-n)*3600+(d-a)*60;return await m({menubar:!0,status:!0},void 0,`-t ${b}`),e.IsRunning=!0,await o.LocalStorage.setItem(e.day,JSON.stringify(e)),!0}return!1}async function w(){let e=await h();return e===void 0||e.IsManuallyDecafed?!1:await N(e)}async function O(){let e=l(),t=await w();return e||t?"Your Mac is currently caffeinated (sleep is prevented)":"Your Mac is not caffeinated (normal sleep settings apply)"}
