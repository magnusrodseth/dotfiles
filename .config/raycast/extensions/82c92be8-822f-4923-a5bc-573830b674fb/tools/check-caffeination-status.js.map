{
  "version": 3,
  "sources": ["../../src/tools/check-caffeination-status.ts", "../../src/status.ts", "../../src/utils.ts"],
  "sourcesContent": ["import { checkSchedule } from \"../status\";\nimport { isCaffeinateRunning } from \"../utils\";\n\n/**\n * Checks if your Mac is currently prevented from sleeping\n */\nexport default async function () {\n  const isCaffeinated = isCaffeinateRunning();\n  const isScheduled = await checkSchedule();\n\n  if (isCaffeinated || isScheduled) {\n    return \"Your Mac is currently caffeinated (sleep is prevented)\";\n  } else {\n    return \"Your Mac is not caffeinated (normal sleep settings apply)\";\n  }\n}\n", "import { LocalStorage, updateCommandMetadata } from \"@raycast/api\";\nimport { Schedule, startCaffeinate, getSchedule, stopCaffeinate, isCaffeinateRunning } from \"./utils\";\n\nasync function handleScheduledCaffeinate(schedule: Schedule): Promise<boolean> {\n  if (!schedule || Object.keys(schedule).length === 0) {\n    return false;\n  }\n\n  const currentDate = new Date();\n  const [startHour, startMinute] = schedule.from.split(\":\").map(Number);\n  const [endHour, endMinute] = schedule.to.split(\":\").map(Number);\n  const currentHour = currentDate.getHours();\n  const currentMinute = currentDate.getMinutes();\n\n  const isWithinSchedule =\n    (currentHour > startHour || (currentHour === startHour && currentMinute >= startMinute)) &&\n    (currentHour < endHour || (currentHour === endHour && currentMinute < endMinute));\n\n  // Change isRunning to false when the schedule has finished its run\n  if (isWithinSchedule === false && schedule.IsRunning === true) {\n    schedule.IsRunning = false;\n    await stopCaffeinate({ menubar: true, status: true });\n    await LocalStorage.setItem(schedule.day, JSON.stringify(schedule));\n    return false;\n  }\n\n  // If the current time is within scheduled time, start caffeination\n  if (isWithinSchedule === true && schedule.IsRunning === false) {\n    const duration = (endHour - startHour) * 3600 + (endMinute - startMinute) * 60;\n    await startCaffeinate({ menubar: true, status: true }, undefined, `-t ${duration}`);\n    schedule.IsRunning = true;\n    await LocalStorage.setItem(schedule.day, JSON.stringify(schedule));\n    return true;\n  }\n\n  return false;\n}\n\n// Function to check and handle schedule\nexport async function checkSchedule() {\n  const schedule = await getSchedule();\n\n  if (schedule === undefined) return false;\n\n  if (!schedule.IsManuallyDecafed) {\n    const isScheduled = await handleScheduledCaffeinate(schedule);\n    return isScheduled;\n  }\n\n  return false;\n}\n\nexport default async function Command() {\n  const isCaffeinated = isCaffeinateRunning();\n  const isScheduled = await checkSchedule();\n\n  let subtitle = \"\u2716 Decaffeinated\";\n\n  if (isCaffeinated) {\n    subtitle = \"\u2714 Caffeinated\";\n  } else if (isScheduled) {\n    subtitle = \"\u2714 Caffeinated\";\n  }\n\n  updateCommandMetadata({ subtitle });\n}\n", "import { getPreferenceValues, launchCommand, LaunchType, LocalStorage, showHUD } from \"@raycast/api\";\nimport { execSync, spawn } from \"node:child_process\";\nimport { Schedule } from \"./interfaces\";\n\nexport type { Schedule };\n\ntype Updates = {\n  menubar: boolean;\n  status: boolean;\n};\n\nexport async function startCaffeinate(updates: Updates, hudMessage?: string, additionalArgs?: string) {\n  if (hudMessage) {\n    await showHUD(hudMessage);\n  }\n  await stopCaffeinate({ menubar: false, status: false });\n\n  // Use spawn with detached: true to properly detach the caffeinate process\n  // This prevents zombie processes when the extension helper exits\n  const args = generateArgs(additionalArgs).split(/\\s+/).filter(Boolean);\n  const child = spawn(\"/usr/bin/caffeinate\", args, {\n    detached: true,\n    stdio: \"ignore\",\n  });\n  child.unref();\n\n  await update(updates, true);\n}\n\nexport async function stopCaffeinate(updates: Updates, hudMessage?: string) {\n  if (hudMessage) {\n    await showHUD(hudMessage);\n  }\n  execSync(\"/usr/bin/killall caffeinate || true\");\n  await update(updates, false);\n}\n\nasync function update(updates: Updates, caffeinated: boolean) {\n  if (updates.menubar) {\n    await tryLaunchCommand(\"index\", { caffeinated });\n  }\n  if (updates.status) {\n    await tryLaunchCommand(\"status\", { caffeinated });\n  }\n}\n\nasync function tryLaunchCommand(commandName: string, context: { caffeinated: boolean }) {\n  try {\n    await launchCommand({ name: commandName, type: LaunchType.Background, context });\n  } catch {\n    // Command might not be enabled\n  }\n}\n\nfunction generateArgs(additionalArgs?: string) {\n  const preferences = getPreferenceValues<Preferences>();\n  const flags = [];\n\n  if (preferences.preventDisplay) flags.push(\"d\");\n  if (preferences.preventDisk) flags.push(\"m\");\n  if (preferences.preventSystem) flags.push(\"i\");\n\n  const parts = [];\n  if (flags.length > 0) parts.push(`-${flags.join(\"\")}`);\n  if (additionalArgs) parts.push(additionalArgs);\n\n  return parts.join(\" \");\n}\n\nexport function isCaffeinateRunning(): boolean {\n  try {\n    execSync(\"pgrep caffeinate\");\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function numberToDayString(dayIndex: number): string {\n  const daysOfWeek = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n  return daysOfWeek[dayIndex];\n}\n\nexport async function getSchedule() {\n  const currentDate = new Date();\n  const currentDayString = numberToDayString(currentDate.getDay()).toLowerCase();\n\n  const getSchedule: string | undefined = await LocalStorage.getItem(currentDayString);\n  if (getSchedule === undefined) return undefined;\n\n  const schedule: Schedule = JSON.parse(getSchedule);\n  return schedule;\n}\n\nexport async function changeScheduleState(operation: string, schedule: Schedule) {\n  switch (operation) {\n    case \"caffeinate\": {\n      schedule.IsManuallyDecafed = false;\n      schedule.IsRunning = false;\n      await LocalStorage.setItem(schedule.day, JSON.stringify(schedule));\n      break;\n    }\n    case \"decaffeinate\": {\n      if (schedule.IsRunning === true || isNotTodaysSchedule(schedule)) {\n        schedule.IsManuallyDecafed = true;\n        schedule.IsRunning = false;\n        await LocalStorage.setItem(schedule.day, JSON.stringify(schedule));\n      }\n      break;\n    }\n\n    default:\n      break;\n  }\n}\n\nexport function isTodaysSchedule(schedule: Schedule) {\n  const currentDate = new Date();\n  const currentDayString = numberToDayString(currentDate.getDay()).toLowerCase();\n\n  if (schedule.day === currentDayString) return true;\n  else return false;\n}\n\nexport function isNotTodaysSchedule(schedule: Schedule) {\n  const currentDate = new Date();\n  const currentDayString = numberToDayString(currentDate.getDay()).toLowerCase();\n\n  if (schedule.day === currentDayString) return false;\n  else return true;\n}\n\n/*\nExample usage:\nconsole.log(formatDuration(1337000)); // Output: \"15d 11h 23m 20s\"\nconsole.log(formatDuration(3600));    // Output: \"1h\"\nconsole.log(formatDuration(65));      // Output: \"1m 5s\"\nconsole.log(formatDuration(86400));   // Output: \"1d\"\n*/\nexport function formatDuration(seconds: number): string {\n  const units = [\n    { label: \"d\", value: 86400 },\n    { label: \"h\", value: 3600 },\n    { label: \"m\", value: 60 },\n    { label: \"s\", value: 1 },\n  ];\n\n  const result: string[] = [];\n\n  for (const unit of units) {\n    const amount = Math.floor(seconds / unit.value);\n    seconds %= unit.value;\n    if (amount > 0) {\n      result.push(`${amount}${unit.label}`);\n    }\n  }\n\n  return result.join(\" \");\n}\n"],
  "mappings": "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",
  "names": ["check_caffeination_status_exports", "__export", "check_caffeination_status_default", "__toCommonJS", "import_api", "import_api", "import_node_child_process", "startCaffeinate", "updates", "hudMessage", "additionalArgs", "stopCaffeinate", "args", "generateArgs", "update", "caffeinated", "tryLaunchCommand", "commandName", "context", "preferences", "flags", "parts", "isCaffeinateRunning", "numberToDayString", "dayIndex", "getSchedule", "currentDayString", "handleScheduledCaffeinate", "schedule", "currentDate", "startHour", "startMinute", "endHour", "endMinute", "currentHour", "currentMinute", "isWithinSchedule", "stopCaffeinate", "duration", "startCaffeinate", "checkSchedule", "getSchedule", "check_caffeination_status_default", "isCaffeinated", "isCaffeinateRunning", "isScheduled", "checkSchedule"]
}
