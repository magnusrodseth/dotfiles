"use strict";var p=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var O=(e,t)=>{for(var n in t)p(e,n,{get:t[n],enumerable:!0})},T=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of R(t))!k.call(e,r)&&r!==n&&p(e,r,{get:()=>t[r],enumerable:!(a=M(t,r))||a.enumerable});return e};var v=e=>T(p({},"__esModule",{value:!0}),e);var N={};O(N,{default:()=>H});module.exports=v(N);var C=require("@raycast/api");var f=require("@raycast/api");async function S(e){let t=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],n=e.toLowerCase(),a=/(\d{2}:\d{2})/g,r=n.match(a);if(!r||r.length<2)return await(0,f.showToast)(f.Toast.Style.Failure,"Oops! Please specify both 'from' and 'to' times in HH:MM format."),null;let[c,u]=r,o=t.filter(d=>n.includes(d));return n.includes("except")?o.length===0?(await(0,f.showToast)(f.Toast.Style.Failure,"Oops! Please mention the days to be excluded."),null):{days:t.filter(s=>!o.includes(s)),from:c,to:u}:{days:o.length>0?o:t,from:c,to:u}}var i=require("@raycast/api"),y=require("node:child_process");async function D(e,t,n){t&&await(0,i.showHUD)(t),await g({menubar:!1,status:!1});let a=L(n).split(/\s+/).filter(Boolean);(0,y.spawn)("/usr/bin/caffeinate",a,{detached:!0,stdio:"ignore"}).unref(),await b(e,!0)}async function g(e,t){t&&await(0,i.showHUD)(t),(0,y.execSync)("/usr/bin/killall caffeinate || true"),await b(e,!1)}async function b(e,t){e.menubar&&await w("index",{caffeinated:t}),e.status&&await w("status",{caffeinated:t})}async function w(e,t){try{await(0,i.launchCommand)({name:e,type:i.LaunchType.Background,context:t})}catch{}}function L(e){let t=(0,i.getPreferenceValues)(),n=[];t.preventDisplay&&n.push("d"),t.preventDisk&&n.push("m"),t.preventSystem&&n.push("i");let a=[];return n.length>0&&a.push(`-${n.join("")}`),e&&a.push(e),a.join(" ")}function h(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]}async function x(){let t=h(new Date().getDay()).toLowerCase(),n=await i.LocalStorage.getItem(t);return n===void 0?void 0:JSON.parse(n)}var m=require("@raycast/api");async function P(e){if(!e||Object.keys(e).length===0)return!1;let t=new Date,[n,a]=e.from.split(":").map(Number),[r,c]=e.to.split(":").map(Number),u=t.getHours(),o=t.getMinutes(),l=(u>n||u===n&&o>=a)&&(u<r||u===r&&o<c);if(l===!1&&e.IsRunning===!0)return e.IsRunning=!1,await g({menubar:!0,status:!0}),await m.LocalStorage.setItem(e.day,JSON.stringify(e)),!1;if(l===!0&&e.IsRunning===!1){let d=(r-n)*3600+(c-a)*60;return await D({menubar:!0,status:!0},void 0,`-t ${d}`),e.IsRunning=!0,await m.LocalStorage.setItem(e.day,JSON.stringify(e)),!0}return!1}async function I(){let e=await x();return e===void 0||e.IsManuallyDecafed?!1:await P(e)}async function H(e){let t=await S(e.schedule);if(!t)throw new Error("Invalid schedule format. Please specify days and time range (HH:MM).");let{days:n,from:a,to:r}=t,c=n.map(s=>({day:s,from:a,to:r,IsManuallyDecafed:!1,IsRunning:!1})),o=h(new Date().getDay()).toLowerCase(),l=await I();for(let s of c)o===s.day&&(s.IsRunning=l),await C.LocalStorage.setItem(s.day,JSON.stringify(s));return`Caffeination scheduled for ${n.map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(", ")} from ${a} to ${r}`}
