"use strict";var g=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var L=(e,t)=>{for(var n in t)g(e,n,{get:t[n],enumerable:!0})},k=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of T(t))!v.call(e,o)&&o!==n&&g(e,o,{get:()=>t[o],enumerable:!(a=C(t,o))||a.enumerable});return e};var I=e=>k(g({},"__esModule",{value:!0}),e);var N={};L(N,{default:()=>S});module.exports=I(N);var u=require("@raycast/api");var r=require("@raycast/api"),c=require("node:child_process");async function y(e,t,n){t&&await(0,r.showHUD)(t),await U({menubar:!1,status:!1});let a=$(n).split(/\s+/).filter(Boolean);(0,c.spawn)("/usr/bin/caffeinate",a,{detached:!0,stdio:"ignore"}).unref(),await w(e,!0)}async function U(e,t){t&&await(0,r.showHUD)(t),(0,c.execSync)("/usr/bin/killall caffeinate || true"),await w(e,!1)}async function w(e,t){e.menubar&&await p("index",{caffeinated:t}),e.status&&await p("status",{caffeinated:t})}async function p(e,t){try{await(0,r.launchCommand)({name:e,type:r.LaunchType.Background,context:t})}catch{}}function $(e){let t=(0,r.getPreferenceValues)(),n=[];t.preventDisplay&&n.push("d"),t.preventDisk&&n.push("m"),t.preventSystem&&n.push("i");let a=[];return n.length>0&&a.push(`-${n.join("")}`),e&&a.push(e),a.join(" ")}async function S(e){let{time:t}=e.arguments,n=/^(\d{1,2})(?::(\d\d))? *(am|pm)?$/i;if(!n.test(t)){await(0,u.showToast)(u.Toast.Style.Failure,"Unrecognized time format");return}let[,a,o,f]=n.exec(t)??[],l=Number(a),i=l;f?.toLowerCase()=="pm"&&l<12&&(i+=12),f?.toLowerCase()=="am"&&l==12&&(i=0);let m=o?Number(o):0;if(i<0||i>24||m<0||m>59){await(0,u.showToast)(u.Toast.Style.Failure,"Unrecognized time format");return}let d=new Date,s=new Date;s.setHours(i),s.setMinutes(m),s.setSeconds(0);let h=f||i>12||a.startsWith("0");for(;s<=d;)s.setHours(s.getHours()+(h?24:12));let D=(s.getTime()-d.getTime())/1e3,b=s.toLocaleTimeString([],{timeStyle:"short"}),x=s.getDate()!=d.getDate()?"tomorrow at ":"";await y({menubar:!0,status:!0},`Caffeinating your Mac until ${x}${b}`,`-t ${D}`)}
